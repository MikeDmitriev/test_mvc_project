# test_mvc_project
Представленный проект является реализацией тестового проекта работы с базой данных некоего банка для создания и обслуживания заявок на оформление банковских карт. 
Для запуска программы необходимо воспользоваться maven из директории с проектом.
(в командной строке написать «mvn spring-boot:run»)
После чего запустится сервер по адресу localhost:8080

# Работа с сервером:
Со стороны front части приходит JSON запрос на создание заявки банковской карты. Отправить запрос можно с использованием сервиса Google Postman. Запрос приходит в следующем виде:

```
{
	"owner":{
		"name":"Иван",
		"surname":"Иванов",
		"patronymic":"Иванович",
		"passportSerial":4455,
		"passportNum":778899,
		"issue":"ОУФМС России по ИКС области в ИГРЕК районе г.N",
		"nationality":"русский"
	},
	"bankCard":{
		"cardNum":0,
		"name":"ПЛАТЕЖНАЯ КАРТА",
		"paySystem":"МИР",
		"type":3,
		"validTime":33333,
		"sign":999,
		"account":0,
		"activate":false
	}
}
```

Поле **type** содержит тип банковской карты (дебетовая/кредитная/…)

Получив запрос контроллер выбирает соответствующий REST, запускающий сервис базы данных. Сервис извлекает из полученного запроса владельца (owner)и банковскую карту (bankCard).
 При создании заявки происходит следующая последовательность действий:
1. Сервис использует таблицу владельцев в базе данных для поиска указанного владельца.
2. Если владелец найден, то используется таблица идентификационных номеров владельца для определения номера заявителя. После чего ищется его счет, указанный в поле account банковской карты.
3. Если счет найден, создается заявка на создание новой карты для этого счета.
4. Если счет не был найден, то создается новый.
5. Если владелец не был найден, то создается новый владелец, для него создается идентификационный номер, счет; для счета создается банковская карта.
6. Регистрируется заявка, содержащая номер заявки, банковскую карту и id владельца.

**ВАЖНО!** При создании нового счета, его номер будет генерироваться автоматически и не будет иметь отношения к счету, к указанному в заявке. Номер банковской карты генерируется автоматически при создании карты в ЛЮБОМ случае, независимо от поля «cardNum» в заявке.
Так же заведены REST’ы для получения по методу GET:
* список всех заявок (ответ - JSON);
* список всех заявок владельца по его паспортным данным (серия и номер) (ответ - JSON);
* список всех счетов владельца (ответ - JSON);
* список всех банковских карт владельца (ответ - JSON);
* список всех счетов в базе данных (ответ - JSON);
* список всех владельцев в базе данных (ответ - JSON);
* список всех идентификационных номеров владельцев; (ответ - JSON)
* информацию о конкретной карте по ее номеру (ответ - JSON);
* активировать конкретную карту по ее номеру (ответ – тип boolean);
* подписать заявку по номеру заявки (ответ – тип boolean);
* установить статус «отправлена» для заявки по ее номеру (ответ – тип boolean);
* установить статус заявки «ГОТОВА» по номеру заявки (ответ – тип boolean).

# Данные, хранящиеся в базе данных:
## Заявка на создание банковской карты:
- номер заявки (первичный ключ);
- статус заявки;
- банковская карта для этой заявки (связь один-к-одному);
- идентификатор владельца (связь многие-к-одному);

## Счета пользователей:
- номер счета (первичный ключ)
- идентификатор владельца (связь многие-к-одному);
- банковская карта (связь один-ко-многим);

## Банковская карта:
- номер карты (первичный ключ);
- имя;
- платежная система;
- тип;
- срок действия;
- сигнатура авторизации;
- флаг активации;
- счет, к которому привязана карта (связь многие-к-одному);
- заявка, на основании которой сделана карта (связь один-к-одному);

## Владельцы:
- Паспортные данные (сочетание полей серии и номера, первичный ключ);
- Имя;
- Фамилия;
- Отчество;
- Подразделение выдачи паспорта;
- Национальность;
- Идентификатор владельца (связь один-к-одному);

## Идентификаторы владельцев:
- Сгенерированный идентификатор (первичный ключ);
- Владелец (связь один-к-одному);
- Счета владельца(связь один-ко-многим);
- Заявки на создание карт владельца (связь один-ко-многим);

# На front-часть будут возвращаться следующие данные:
## Заявка на создание карты:

```
{
	"requestId": 1,
	"status": "CREATED",
	"owner": {
			"name": "Иван",
			"surname": "Иванов",
			"patronymic": "Иванович",
			"passportSerial": 4455,
			"passportNum": 778899,
			"issue": "ОУФМС России по ИКС области в ИГРЕК районе г.N",
			"nationality": "русский"
},
	"bankCard": {
			"cardNum": cardNum,
			"name": "ПЛАТЕЖНАЯ КАРТА",
			"paySystem": "МИР",
			"type": 3,
			"validTime": 33333,
			"sign": 999,
			"account": accountNum,
			"activate": activateFlag
	}
}
```

cardNum, accountNum и activateFlag – текущие значения в базе данных.
 
## Владелец:

```
{
	"name": "Иван",
	"surname": "Иванов",
	"patronymic": "Иванович",
	"passportSerial": 4455,
	"passportNum": 778899,
	"issue": "ОУФМС России по ИКС области в ИГРЕК районе г.N",
	"nationality": "русский"
}
```

## Карта:

```
{
	"cardNum": cardNum,
	"name": "ПЛАТЕЖНАЯ КАРТА",
	"paySystem": "МИР",
	"type": 3,
	"validTime": 33333,
	"sign": 999,
	"account": accountNum,
	"activate": activateFlag
}
```

cardNum, accountNum и activateFlag – текущие значения в базе данных.

## Счет:

```
{
	"account": 1,
	"ownerId": {
		"ownerId": 1,
		"owner": {
			"name": "Имя",
			"surname": "Иванов",
			"patronymic": "Иванович",
			"passportSerial": 4455,
			"passportNum": 778899,
			"issue": "ОУФМС России по ИКС области в ИГРЕК районе г.N",
			"nationality": "русский"
		}
	}
}
```

## Идентификационный номер владельца:

```
{
	"ownerId": 1,
	"owner": {
		"name": "Иван",
		"surname": "Иванов",
		"patronymic": "Иванович",
		"passportSerial": 4455,
		"passportNum": 778899,
		"issue": "ОУФМС России по ИКС области в ИГРЕК районе г.N",
		"nationality": "русский"
	}
}
```
